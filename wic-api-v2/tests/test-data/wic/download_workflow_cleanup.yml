steps:
- BbbcDownload:
  in:
    name: "BBBC001"
- FileRenaming:
    in:
      filePattern: .*_{row:c}{col:dd}f{f:dd}d{channel:d}.tif
      inpDir: '*outDirBBBCDownload'
      mapDirectory: map
      outDir: '&inpDirOmeConverter'
      outFilePattern: x{row:dd}_y{col:dd}_p{f:dd}_c{channel:d}.tif
- OmeConverter:
    in:
      fileExtension: .ome.tif
      filePattern: .*.tif
      inpDir: '*inpDirOmeConverter'
      outDir: '&inpDirBasicFlatfieldEstimation'
- BasicFlatfieldEstimation:
    in:
      filePattern: d1_x00_y03_p{p:dd}_c{c:d}.ome.tif
      getDarkfield: true
      groupBy: c
      inpDir: '*inpDirBasicFlatfieldEstimation'
      outDir: '&ffDirApplyFlatfield'
- ApplyFlatfield:
    in:
      dfPattern: d1_x00_y03_p0\(0-5\)_c{c:d}_darkfield.ome.tif
      ffDir: '*ffDirApplyFlatfield'
      ffPattern: d1_x00_y03_p0\(0-5\)_c{c:d}_flatfield.ome.tif
      imgDir: '*inpDirBasicFlatfieldEstimation'
      imgPattern: d1_x00_y03_p{p:dd}_c{c:d}.ome.tif
      outDir: 'outDir'